{
    "name": "ems_user_loader_db",
	"comment": "Catalog for ems_user_loader_db",
	"owner": "data_loader",
	"version": "1.0.0",
	"service" : "ems_data_loader:start",
	"url": "/emsbus/ems_user_loader_db",
	"type": "KERNEL",
	"lang" : "erlang",
	"update_checkpoint" : 30000,
	"datasource" : "ds_ems_user_loader",
	"start_timeout" : 3000,
	"middleware" : "ems_user_loader_middleware",
	"group" : [],
	"pool_size" : 1,
	"pool_max" : 1,
	"enable" : false,
	"source_type" : "user_db",
	"sql_load" : 
				"select u.UsuId as Id,   
					   p.PesCodigoPessoa as Codigo, 
					   lower(rtrim(u.UsuLogin)) as Login, 
					   rtrim(p.PesNome) as Nome,  
					   rtrim(cast(p.PesCpf as varchar(14))) as Cpf, 
					   rtrim(cast(u.UsuSenha as varchar(60))) as Password, 
					   'SHA1' as PasswdCryptoPessoa, 
					   rtrim(p.PesEndereco) as Endereco, 
					   rtrim(p.PesComplementoEndereco) as ComplementoEndereco, 
					   rtrim(p.PesBairro) as Bairro, 
					   rtrim(p.PesCidade) as Cidade, 
					   p.PesUf as Uf, 
					   rtrim(p.PesCep) as Cep, 
					   rtrim(p.PesRg) as Rg, 
					   p.PesDataNascimento as DataNascimento, 
					   p.PesSexo as Sexo, 
					   rtrim(p.PesTelefone) as Telefone, 
					   rtrim(p.PesCelular) as Celular, 
					   rtrim(p.PesDDD) as DDD,
					   p.PesNomePai,
					   p.PesNomeMae,
					   cast(p.PesNacionalidade as int) as nacionalidade,
					   lower(rtrim(p.PesEmail)) as email,
  					   1 as Type,  
					   0 as SubType, 
	   				   1 as Active, 
					   u.UsuDataTroca + u.UsuFrequenciaTroca as DtExpirePassword    
				from BDAcesso.dbo.TB_Usuario u join BDPessoa.dbo.TB_Pessoa p 
					 on u.UsuPesIdPessoa = p.PesCodigoPessoa 
				",

	"sql_update" :
			"select u.UsuId as Id, 
				   p.PesCodigoPessoa as Codigo, 
				   lower(rtrim(u.UsuLogin)) as Login, 
				   rtrim(p.PesNome) as Nome, 
				   rtrim(cast(p.PesCpf as varchar(14))) as Cpf, 
				   rtrim(cast(u.UsuSenha as varchar(60))) as Password, 
				   'SHA1' as PasswdCryptoPessoa, 
				   rtrim(p.PesEndereco) as Endereco, 
				   rtrim(p.PesComplementoEndereco) as ComplementoEndereco, 
				   rtrim(p.PesBairro) as Bairro, 
				   rtrim(p.PesCidade) as Cidade, 
				   p.PesUf as Uf, 
				   rtrim(p.PesCep) as Cep, 
				   rtrim(p.PesRg) as Rg, 
				   p.PesDataNascimento as DataNascimento, 
				   p.PesSexo as Sexo, 
				   rtrim(p.PesTelefone) as Telefone, 
				   rtrim(p.PesCelular) as Celular, 
				   rtrim(p.PesDDD) as DDD,
				   p.PesNomePai,
				   p.PesNomeMae,
				   cast(p.PesNacionalidade as int) as nacionalidade,
				   lower(rtrim(p.PesEmail)) as email,
				   1 as Type,  
				   0 as SubType,	
				   1 as Active, 
				   u.UsuDataTroca + u.UsuFrequenciaTroca as DtExpirePassword   
			from BDAcesso.dbo.TB_Usuario u join BDPessoa.dbo.TB_Pessoa p 
				 on u.UsuPesIdPessoa = p.PesCodigoPessoa  
			where u.UsuDataAlteracao >= ? or p.PesDataAlteracao >= ? or 
			      u.UsuDataCadastramento >= ? or p.PesDataCadastramento >= ?
			",
			
	"fields" : ["id", "codigo", "login", "name", "cpf", "password", 
				"passwd_crypto", "endereco", "complemento_endereco", 
				"bairro", "cidade", "uf", "cep", "rg", "data_nascimento", 
				"sexo", "telefone", "celular", "ddd", "nome_pai", "nome_mae", "nacionalidade", 
				"email", "type", "subtype", "active", "dt_expire_password"]
				
}
